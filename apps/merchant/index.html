<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ClickMenu Merchant</title>
    <link rel="stylesheet" href="/public/assets/css/shared.css" />
    <link rel="stylesheet" href="/public/assets/css/merchant.css" />
    <script src="/public/assets/js/api.js"></script>
    <script src="/public/assets/js/ui.js"></script>
    <script src="/public/assets/js/formatters.js"></script>
  </head>
  <body class="merchant-body">
    <div class="background-texture"></div>
    <main class="merchant-shell">
      <section class="login-view" id="loginView">
        <div class="login-card glass-card">
          <div class="login-brand">ClickMenu Merchant</div>
          <h1>Welcome back</h1>
          <p class="muted">Sign in to your control room.</p>
          <label class="field">
            <span>Store ID or Email</span>
            <input id="loginId" placeholder="e.g. LUNA01 or hello@store.com" />
          </label>
          <label class="field">
            <span>Passcode</span>
            <input id="loginPass" type="password" placeholder="••••••••" />
          </label>
          <div class="inline-message" id="loginError" role="alert"></div>
          <details class="login-debug" id="loginDebug" hidden>
            <summary>Login diagnostics</summary>
            <div class="debug-grid">
              <div>
                <span class="muted">Endpoint</span>
                <strong id="loginDebugEndpoint">—</strong>
              </div>
              <div>
                <span class="muted">Status</span>
                <strong id="loginDebugStatus">—</strong>
              </div>
              <div class="debug-full">
                <span class="muted">Response snippet</span>
                <code id="loginDebugSnippet">—</code>
              </div>
              <div class="debug-full">
                <span class="muted">Hint</span>
                <strong id="loginDebugHint">Check Cloud Run env vars + server route</strong>
              </div>
            </div>
          </details>
          <button class="btn btn-primary" id="loginBtn">Access Portal</button>
          <p class="helper">Need access? Ask your administrator to reset your merchant passcode.</p>
        </div>
      </section>

      <section class="dashboard-view" id="dashboardView" hidden>
        <div class="merchant-layout">
          <aside class="merchant-sidebar">
            <div class="sidebar-brand">
              <span class="sidebar-logo">CM</span>
              <span>ClickMenu</span>
            </div>
            <nav class="sidebar-nav">
              <button class="sidebar-link active" data-section="dashboard">Dashboard</button>
              <button class="sidebar-link" data-section="menu">Menu Manager</button>
              <button class="sidebar-link" data-section="orders">Orders Inbox</button>
              <button class="sidebar-link" data-section="profile">Profile</button>
              <button class="sidebar-link" data-section="settings">Settings</button>
            </nav>
            <div class="sidebar-footer">
              <button class="btn btn-secondary btn-sm" id="logoutBtn">Log out</button>
            </div>
          </aside>

          <div class="merchant-main">
            <header class="merchant-header">
              <div class="store-identity">
                <div class="store-avatar">
                  <img id="storeLogo" src="" alt="Store logo" />
                </div>
                <div>
                  <p class="overline">Merchant Portal</p>
                  <h2 id="storeName">Store Name</h2>
                  <div class="status-pill" id="storeStatus"></div>
                </div>
              </div>
              <div class="header-actions">
                <button class="btn btn-secondary" id="refreshBtn">Refresh</button>
                <a
                  class="btn btn-secondary"
                  id="viewStorefrontBtn"
                  href="/storefront"
                  target="_blank"
                  rel="noreferrer"
                >
                  View Storefront
                </a>
              </div>
            </header>

            <section class="panel-section" id="dashboardPanel">
          <div class="panel glass-card">
            <div class="panel-header">
              <div>
                <h3>Control Room</h3>
                <p class="muted">Your real-time performance snapshot.</p>
              </div>
              <div class="pill" id="ordersPulse">Live</div>
            </div>
            <div class="kpi-grid" id="kpiRow"></div>
          </div>

          <div class="dashboard-grid">
            <div class="panel glass-card">
              <div class="panel-header">
                <h3>Needs Attention</h3>
                <p class="muted">Priority tasks to unlock growth.</p>
              </div>
              <div class="attention-list" id="attentionList"></div>
            </div>
            <div class="panel glass-card">
              <div class="panel-header">
                <h3>Storefront Preview</h3>
                <p class="muted">Exactly how customers see you.</p>
              </div>
              <div class="storefront-preview" id="storefrontPreview"></div>
            </div>
          </div>

          <div class="dashboard-grid">
            <div class="panel glass-card">
              <div class="panel-header">
                <h3>Orders Trend</h3>
                <p class="muted">Last 7 days of incoming orders.</p>
              </div>
              <div class="chart-wrapper">
                <div class="bar-chart" id="ordersTrendChart" aria-label="Orders trend chart"></div>
                <div class="chart-legend" id="ordersTrendLegend"></div>
              </div>
            </div>
            <div class="panel glass-card">
              <div class="panel-header">
                <h3>Fulfillment Mix</h3>
                <p class="muted">Pickup vs delivery requests.</p>
              </div>
              <div class="chart-wrapper">
                <div class="stacked-chart" id="fulfillmentMixChart" aria-label="Fulfillment mix chart"></div>
                <div class="chart-legend" id="fulfillmentMixLegend"></div>
              </div>
            </div>
          </div>
        </section>

        <section class="panel-section" id="menuPanel" hidden>
          <div class="menu-layout">
            <div class="panel glass-card">
              <div class="panel-header">
                <h3>Menu Item Builder</h3>
                <p class="muted">Create premium dishes that convert.</p>
              </div>
              <div class="form-grid">
                <label class="field">
                  <span>Item ID</span>
                  <input id="itemId" placeholder="FOOD-001" />
                </label>
                <label class="field">
                  <span>Title</span>
                  <input id="itemTitle" placeholder="Truffle Jerk Chicken" />
                </label>
                <label class="field field-full">
                  <span>Description</span>
                  <textarea id="itemDescription" rows="3" placeholder="Describe what makes it unforgettable."></textarea>
                </label>
                <label class="field">
                  <span>Category</span>
                  <select id="itemCategory">
                    <option value="">Select category</option>
                    <option value="Breakfast">Breakfast</option>
                    <option value="Lunch">Lunch</option>
                    <option value="Dinner">Dinner</option>
                    <option value="Drinks">Drinks</option>
                    <option value="Snacks">Snacks</option>
                    <option value="Dessert">Dessert</option>
                  </select>
                </label>
                <label class="field">
                  <span>Price</span>
                  <input id="itemPrice" type="number" min="0" step="0.01" placeholder="0.00" />
                </label>
              </div>

              <div class="toggle-row">
                <label class="toggle">
                  <input type="checkbox" id="itemAvailable" />
                  <span>Available</span>
                </label>
                <label class="toggle">
                  <input type="checkbox" id="itemLimited" />
                  <span>Limited Batch</span>
                </label>
                <label class="toggle">
                  <input type="checkbox" id="itemFeatured" />
                  <span>Featured</span>
                </label>
              </div>

              <div class="panel-subsection">
                <h4>Labels</h4>
                <div class="label-grid">
                  <label><input type="checkbox" class="label-checkbox" value="Chef's Special" /> Chef's Special</label>
                  <label><input type="checkbox" class="label-checkbox" value="Most Loved" /> Most Loved</label>
                  <label><input type="checkbox" class="label-checkbox" value="Spicy" /> Spicy</label>
                  <label><input type="checkbox" class="label-checkbox" value="Vegan" /> Vegan</label>
                </div>
                <input id="customLabel" placeholder="Custom label (optional)" />
              </div>

              <div class="panel-subsection">
                <h4>Media</h4>
                <p class="muted">Upload one image and one video to showcase this dish.</p>
                <div class="media-uploader">
                  <input id="uploadInput" type="file" accept="image/*,video/*" />
                  <button class="btn btn-primary" id="uploadBtn" type="button">Upload Media</button>
                </div>
                <div class="media-preview" id="mediaPreview"></div>
                <div class="form-grid">
                  <label class="field">
                    <span>Image URL</span>
                    <input id="itemImageUrl" placeholder="https://" />
                  </label>
                  <label class="field">
                    <span>Video URL</span>
                    <input id="itemVideoUrl" placeholder="https://" />
                  </label>
                </div>
              </div>

              <div class="button-row">
                <button class="btn btn-primary" id="saveItemBtn">Save Item</button>
                <button class="btn btn-secondary" id="resetItemBtn" type="button">New Item</button>
                <button class="btn btn-ghost" id="hideItemBtn" type="button">Archive Item</button>
              </div>
            </div>

            <div class="panel glass-card">
              <div class="panel-header">
                <div>
                  <h3>Inventory</h3>
                  <p class="muted" id="menuCount">0 items</p>
                </div>
                <div class="pill">Live Menu</div>
              </div>
              <div class="toolbar">
                <input id="menuSearch" placeholder="Search by name or ID" />
                <select id="menuCategoryFilter">
                  <option value="">All categories</option>
                  <option value="Breakfast">Breakfast</option>
                  <option value="Lunch">Lunch</option>
                  <option value="Dinner">Dinner</option>
                  <option value="Drinks">Drinks</option>
                  <option value="Snacks">Snacks</option>
                  <option value="Dessert">Dessert</option>
                </select>
                <select id="menuAvailabilityFilter">
                  <option value="">All status</option>
                  <option value="available">Available</option>
                  <option value="limited">Limited</option>
                  <option value="sold_out">Sold out</option>
                  <option value="hidden">Archived</option>
                </select>
                <select id="menuSort">
                  <option value="requested">Most requested</option>
                  <option value="alpha">Alphabetical</option>
                  <option value="price_desc">Price high-low</option>
                  <option value="price_asc">Price low-high</option>
                </select>
              </div>
              <div class="list-table">
                <div class="list-header menu-row">
                  <span>Item</span>
                  <span>Status</span>
                  <span>Price</span>
                  <span>Requests</span>
                  <span>Actions</span>
                </div>
                <div class="list-body" id="itemsList"></div>
              </div>
            </div>
          </div>
        </section>

        <section class="panel-section" id="ordersPanel" hidden>
          <div class="panel glass-card">
            <div class="panel-header">
              <div>
                <h3>Orders Inbox</h3>
                <p class="muted">Respond quickly to keep momentum high.</p>
              </div>
              <div class="pill" id="newOrdersCount">0 new</div>
            </div>
            <div class="toolbar">
              <input id="orderSearch" placeholder="Search by customer or order ID" />
              <select id="orderStatusFilter">
                <option value="">All statuses</option>
                <option value="new">New</option>
                <option value="in_progress">In progress</option>
                <option value="completed">Completed</option>
              </select>
            </div>
            <div class="list-table">
              <div class="list-header order-row">
                <span>Order</span>
                <span>Status</span>
                <span>Fulfillment</span>
                <span>Total</span>
                <span>Actions</span>
              </div>
              <div class="list-body" id="ordersList"></div>
            </div>
          </div>
        </section>

        <section class="panel-section" id="profilePanel" hidden>
          <div class="profile-layout">
            <div class="panel glass-card">
              <div class="panel-header">
                <h3>Store Settings</h3>
                <p class="muted">Keep this polished for trust and conversion.</p>
              </div>
              <div class="completion-meter">
                <div class="completion-header">
                  <span>Profile completion</span>
                  <strong id="completionValue">0%</strong>
                </div>
                <div class="completion-bar">
                  <span id="completionBar"></span>
                </div>
              </div>
              <div class="form-grid">
                <label class="field">
                  <span>Store name</span>
                  <input id="profileStoreName" placeholder="Luna Tacos" />
                </label>
                <label class="field">
                  <span>Logo URL</span>
                  <input id="profileLogoUrl" placeholder="https://" />
                </label>
                <label class="field">
                  <span>WhatsApp</span>
                  <input id="profileWhatsapp" placeholder="+15550001111" />
                </label>
                <label class="field">
                  <span>Contact email</span>
                  <input id="profileEmail" placeholder="hello@store.com" />
                </label>
                <label class="field">
                  <span>Cuisine type</span>
                  <input id="profileCuisine" placeholder="Modern Caribbean" />
                </label>
                <label class="field field-full">
                  <span>Business description</span>
                  <textarea id="profileDescription" rows="3" placeholder="Share the story behind your menu."></textarea>
                </label>
                <label class="field">
                  <span>Operating hours</span>
                  <input id="profileHours" placeholder="Mon-Sat 11am-9pm" />
                </label>
                <label class="field">
                  <span>Business address</span>
                  <input id="businessAddress" placeholder="12 Duke Street" />
                </label>
                <label class="field">
                  <span>Parish</span>
                  <input id="businessParish" placeholder="Kingston" />
                </label>
                <label class="field">
                  <span>Owner name</span>
                  <input id="ownerName" placeholder="Owner name" />
                </label>
                <label class="field">
                  <span>Owner phone</span>
                  <input id="ownerPhone" placeholder="Owner phone" />
                </label>
                <label class="field">
                  <span>Owner email</span>
                  <input id="ownerEmail" placeholder="owner@store.com" />
                </label>
                <label class="field">
                  <span>Instagram</span>
                  <input id="instagramHandle" placeholder="@yourstore" />
                </label>
                <label class="field">
                  <span>TikTok</span>
                  <input id="tiktokHandle" placeholder="@yourstore" />
                </label>
              </div>
              <div class="panel-subsection">
                <h4>Completion checklist</h4>
                <div class="checklist" id="completionChecklist"></div>
              </div>
              <div class="toggle-row">
                <label class="toggle">
                  <input type="checkbox" id="pickupEnabled" />
                  <span>Pickup enabled</span>
                </label>
                <label class="toggle">
                  <input type="checkbox" id="deliveryEnabled" />
                  <span>Delivery enabled</span>
                </label>
              </div>
              <div class="button-row">
                <button class="btn btn-primary" id="saveProfileBtn">Save Profile</button>
              </div>
            </div>
            <div class="panel glass-card">
              <div class="panel-header">
                <h3>Storefront Preview</h3>
                <p class="muted">Customers will see this in the storefront.</p>
              </div>
              <div id="profilePreview" class="storefront-preview"></div>
            </div>
          </div>
        </section>
        <section class="panel-section" id="settingsPanel" hidden>
          <div class="panel glass-card">
            <div class="panel-header">
              <h3>Settings</h3>
              <p class="muted">Keep your portal access and preferences safe.</p>
            </div>
            <div class="button-row">
              <button class="btn btn-secondary" id="settingsRefreshBtn" type="button">
                Refresh data
              </button>
              <button class="btn btn-secondary" id="settingsLogoutBtn" type="button">
                Log out
              </button>
            </div>
          </div>
        </section>
          </div>
        </div>
      </section>
    </main>
    <div class="drawer-backdrop" id="orderBackdrop"></div>
    <aside class="order-drawer" id="orderDrawer" aria-hidden="true">
      <div class="drawer-header">
        <div>
          <h3 id="drawerOrderId">Order</h3>
          <p class="muted" id="drawerOrderMeta">—</p>
        </div>
        <button class="btn btn-ghost" id="closeOrderDrawer" type="button">Close</button>
      </div>
      <div class="drawer-section" id="drawerCustomer"></div>
      <div class="drawer-section" id="drawerItems"></div>
      <div class="drawer-section" id="drawerNotes"></div>
      <div class="drawer-actions">
        <button class="btn btn-secondary" id="markContactedBtn" type="button">Mark contacted</button>
        <button class="btn btn-secondary" id="markReadyBtn" type="button">Mark ready</button>
        <button class="btn btn-primary" id="markClosedBtn" type="button">Closed</button>
        <a class="btn btn-secondary" id="drawerWhatsappBtn" href="#" target="_blank" rel="noreferrer">WhatsApp customer</a>
      </div>
    </aside>
    <script src="/public/assets/js/merchant.js" defer></script>
  </body>
</html>

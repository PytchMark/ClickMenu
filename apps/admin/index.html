<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ClickMenu Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="/public/assets/css/shared.css" />
    <link rel="stylesheet" href="/public/assets/css/admin.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/public/assets/js/api.js" defer></script>
    <script src="/public/assets/js/ui.js" defer></script>
    <script src="/public/assets/js/formatters.js" defer></script>
    <script src="/public/assets/js/admin.js" defer></script>
  </head>
  <body class="admin-body">
    <div class="texture"></div>

    <div class="login-view" id="loginView">
      <div class="login-panel">
        <div class="login-brand">ClickMenu</div>
        <h1>Admin Portal</h1>
        <p class="muted">Secure access for operations and support.</p>
        <label class="field">
          <span>Username or email</span>
          <input id="adminUser" placeholder="admin@company.com" />
        </label>
        <label class="field">
          <span>Password</span>
          <input id="adminPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        </label>
        <button class="btn primary" id="adminLoginBtn">Log in</button>
      </div>
    </div>

    <div class="admin-shell hidden" id="adminShell">
      <aside class="sidebar">
        <div class="brand">
          <div class="brand-mark"><img src="https://res.cloudinary.com/dd8pjjxsm/image/upload/v1771556041/IMG-20260219-WA0080_msvwo2.jpg" alt="ClickMenu" class="brand-logo-img" /></div>
          <div>
            <div class="brand-name">ClickMenu</div>
            <div class="brand-sub">Admin Console</div>
          </div>
        </div>
        <nav class="nav">
          <button class="nav-item active" data-view="overview">Overview</button>
          <button class="nav-item" data-view="merchants">Merchants</button>
          <button class="nav-item" data-view="menu">Menu Items</button>
          <button class="nav-item" data-view="orders">Orders</button>
          <button class="nav-item" data-view="analytics">Analytics</button>
          <button class="nav-item" data-view="moderation">Moderation</button>
          <button class="nav-item" data-view="settings">Settings</button>
        </nav>
        <div class="sidebar-footer">
          <div class="status-pill">Cloud Run ready</div>
        </div>
      </aside>

      <main class="main">
        <header class="topbar">
          <div class="search">
            <span class="search-icon">ðŸ”Ž</span>
            <input id="globalSearch" placeholder="Search merchants, orders, items" />
          </div>
          <div class="top-actions">
            <button class="btn ghost" id="exportCsvBtn">Export CSV</button>
            <button class="btn primary" id="createMerchantBtn">Create merchant</button>
            <button class="btn ghost" id="adminLogout">Log out</button>
          </div>
        </header>

        <div class="filter-row hidden" id="filterRow"></div>

        <section class="view active" id="view-overview">
          <div class="grid-4" id="overviewCards"></div>
          
          <div class="overview-charts">
            <div class="panel chart-panel">
              <h3><i class="fas fa-chart-line"></i> Orders Trend (7 days)</h3>
              <canvas id="adminOrdersChart" height="200"></canvas>
            </div>
            <div class="panel chart-panel">
              <h3><i class="fas fa-chart-pie"></i> Merchant Distribution</h3>
              <canvas id="adminMerchantChart" height="200"></canvas>
            </div>
          </div>
          
          <div class="panel split">
            <div>
              <h3><i class="fas fa-bolt"></i> Ops Pulse</h3>
              <div class="list" id="opsPulse"></div>
            </div>
            <div>
              <h3><i class="fas fa-clock"></i> Recent Orders</h3>
              <div class="list" id="overviewOrders"></div>
            </div>
          </div>
          
          <div class="panel">
            <h3><i class="fas fa-exclamation-triangle"></i> Needs Attention</h3>
            <div class="attention-grid" id="adminAttention"></div>
          </div>
        </section>

        <section class="view" id="view-merchants">
          <div class="panel">
            <div class="panel-header">
              <div>
                <h3>Merchants</h3>
                <p class="muted">Manage storefronts at scale.</p>
              </div>
              <div class="panel-actions">
                <select id="merchantStatusFilter">
                  <option value="">All status</option>
                  <option value="active">Active</option>
                  <option value="paused">Paused</option>
                  <option value="onboarding">Onboarding</option>
                  <option value="flagged">Flagged</option>
                </select>
                <input id="merchantParishFilter" placeholder="Parish" />
                <select id="merchantSort">
                  <option value="newest">Newest</option>
                  <option value="orders">Most orders</option>
                </select>
              </div>
            </div>
            <div class="bulk-actions">
              <label class="checkbox">
                <input type="checkbox" id="selectAllMerchants" />
                <span>Select all</span>
              </label>
              <button class="btn ghost" id="bulkActivateBtn">Activate</button>
              <button class="btn ghost" id="bulkPauseBtn">Pause</button>
              <button class="btn ghost" id="bulkResetBtn">Reset passcodes</button>
              <button class="btn ghost" id="bulkExportBtn">Export selected</button>
            </div>
            <div class="table-wrapper">
              <table class="data-table">
                <thead>
                  <tr>
                    <th></th>
                    <th>Merchant</th>
                    <th>Store ID</th>
                    <th>Status</th>
                    <th>Orders (Today / 7d)</th>
                    <th>Profile</th>
                    <th>Last active</th>
                    <th>WhatsApp</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="merchantTableBody"></tbody>
              </table>
            </div>
            <div class="pagination" id="merchantPagination"></div>
          </div>
        </section>

        <section class="view" id="view-menu">
          <div class="panel">
            <div class="panel-header">
              <div>
                <h3>Menu Items</h3>
                <p class="muted">Moderate items across the platform.</p>
              </div>
              <div class="panel-actions">
                <input id="menuStoreFilter" placeholder="Store ID" />
                <input id="menuCategoryFilter" placeholder="Category" />
                <select id="menuAvailabilityFilter">
                  <option value="">All availability</option>
                  <option value="available">Available</option>
                  <option value="limited">Limited</option>
                  <option value="unavailable">Unavailable</option>
                </select>
                <select id="menuFeaturedFilter">
                  <option value="">Featured?</option>
                  <option value="true">Featured</option>
                  <option value="false">Not featured</option>
                </select>
                <label class="checkbox">
                  <input type="checkbox" id="menuMissingMedia" />
                  <span>Missing media</span>
                </label>
              </div>
            </div>
            <div class="table-wrapper">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Item</th>
                    <th>Store</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Price</th>
                    <th>Featured</th>
                    <th>Media</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="menuTableBody"></tbody>
              </table>
            </div>
            <div class="pagination" id="menuPagination"></div>
          </div>
        </section>

        <section class="view" id="view-orders">
          <div class="panel">
            <div class="panel-header">
              <div>
                <h3>Orders Inbox</h3>
                <p class="muted">Track customer requests across merchants.</p>
              </div>
              <div class="panel-actions">
                <input id="ordersStoreFilter" placeholder="Store ID" />
                <select id="ordersStatusFilter">
                  <option value="">All status</option>
                  <option value="new">New</option>
                  <option value="contacted">Contacted</option>
                  <option value="confirmed">Confirmed</option>
                  <option value="closed">Closed</option>
                </select>
                <input id="ordersFrom" type="date" />
                <input id="ordersTo" type="date" />
              </div>
            </div>
            <div class="table-wrapper">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Order</th>
                    <th>Merchant</th>
                    <th>Customer</th>
                    <th>Fulfillment</th>
                    <th>Parish</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="ordersTableBody"></tbody>
              </table>
            </div>
            <div class="pagination" id="ordersPagination"></div>
          </div>
        </section>

        <section class="view" id="view-analytics">
          <div class="grid-3" id="analyticsCards"></div>
          <div class="panel">
            <h3>Top merchants (7d)</h3>
            <div class="list" id="topMerchants"></div>
          </div>
          <div class="panel">
            <h3>Top items requested</h3>
            <div class="list" id="topItems"></div>
          </div>
          <div class="panel">
            <h3>Dead merchants</h3>
            <div class="list" id="deadMerchants"></div>
          </div>
        </section>

        <section class="view" id="view-moderation">
          <div class="panel">
            <h3>Moderation</h3>
            <p class="muted">Review flagged merchants, items, and customer feedback. (Coming soon)</p>
          </div>
        </section>

        <section class="view" id="view-settings">
          <div class="panel">
            <h3>Settings</h3>
            <p class="muted">Manage admin users, audit policies, and export schedules. (Coming soon)</p>
          </div>
        </section>
      </main>
    </div>

    <div class="drawer" id="drawer">
      <div class="drawer-content" id="drawerContent"></div>
    </div>

    <div class="modal" id="modal">
      <div class="modal-card">
        <div class="modal-header">
          <h3>Create merchant</h3>
          <button class="icon-btn" id="closeModal">âœ•</button>
        </div>
        <div class="modal-body">
          <div class="form-grid">
            <label class="field">
              <span>Store ID</span>
              <input id="createStoreId" />
            </label>
            <label class="field">
              <span>Store name</span>
              <input id="createStoreName" />
            </label>
            <label class="field">
              <span>WhatsApp</span>
              <input id="createStoreWhatsapp" />
            </label>
            <label class="field">
              <span>Profile email</span>
              <input id="createStoreEmail" />
            </label>
            <label class="field">
              <span>Logo URL</span>
              <input id="createStoreLogo" />
            </label>
            <label class="field">
              <span>Status</span>
              <select id="createStoreStatus">
                <option value="active">Active</option>
                <option value="paused">Paused</option>
                <option value="onboarding">Onboarding</option>
              </select>
            </label>
            <label class="field">
              <span>Passcode (optional)</span>
              <input id="createStorePasscode" />
            </label>
            <label class="field">
              <span>Business address</span>
              <input id="createStoreAddress" />
            </label>
            <label class="field">
              <span>Parish</span>
              <input id="createStoreParish" />
            </label>
            <label class="field">
              <span>Owner name (internal)</span>
              <input id="createOwnerName" />
            </label>
            <label class="field">
              <span>Owner phone (internal)</span>
              <input id="createOwnerPhone" />
            </label>
            <label class="field">
              <span>Owner email (internal)</span>
              <input id="createOwnerEmail" />
            </label>
            <label class="field">
              <span>Hours</span>
              <input id="createStoreHours" />
            </label>
            <label class="field full">
              <span>About</span>
              <textarea id="createStoreAbout" rows="3"></textarea>
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn ghost" id="cancelModal">Cancel</button>
          <button class="btn primary" id="submitCreateStore">Create merchant</button>
        </div>
      </div>
    </div>
  </body>
</html>
